<button
  type="button"
  class="p-2 pl-4 border border-gray-300 bg-white rounded flex transition-all duration-100 hover:text-primary-darker hover:border-primary-lightest focus:text-primary-darker focus:border-primary-lightest"
  [title]="title"
  [attr.aria-owns]="id"
  (click)="toggleOverlay()"
  (keydown)="handleKeydown($event)"
  cdkOverlayOrigin
  #overlayOrigin="cdkOverlayOrigin"
>
  <span class="flex-grow truncate font-medium mr-2">
    {{ title }}
  </span>
  <mat-icon class="flex-shrink-0 opacity-[40%]">
    <ng-container *ngIf="overlayOpen">expand_less</ng-container>
    <ng-container *ngIf="!overlayOpen">expand_more</ng-container>
  </mat-icon>
</button>

<ng-template
  cdkConnectedOverlay
  cdkConnectedOverlayHasBackdrop
  cdkConnectedOverlayBackdropClass="cdk-overlay-transparent-backdrop"
  [cdkConnectedOverlayOrigin]="overlayOrigin"
  [cdkConnectedOverlayOpen]="overlayOpen"
  [cdkConnectedOverlayPositions]="overlayPositions"
  [cdkConnectedOverlayScrollStrategy]="scrollStrategy"
  [cdkConnectedOverlayOffsetY]="8"
  (backdropClick)="closeOverlay()"
  (attach)="openOverlay()"
  (detach)="closeOverlay()"
>
  <div
    class="bg-white border border-gray-300 rounded shadow-lg py-2 w-full overflow-x-hidden overflow-y-auto"
    [style.max-height]="overlayMaxHeight"
    [style.width]="overlayWidth"
    role="listbox"
    tabindex="-1"
    [attr.id]="id"
    [attr.aria-multiselectable]="true"
    [attr.aria-label]="title"
  >
    <div *ngFor="let choice of choices">
      <mat-checkbox
        class="px-5 py-1 w-full text-gray-900 hover:text-primary-darkest hover:bg-gray-50"
        [aria-label]="choice.label"
        [checked]="isSelected(choice)"
        (change)="select(choice, $event.checked)"
      >
        <span class="ml-[2px] text-[14px] truncate">
          {{ choice.label }}
        </span>
      </mat-checkbox>
    </div>
  </div>
</ng-template>
